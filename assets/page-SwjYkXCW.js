import{r as u,u as y,j as o,T as k}from"./index-MtvP_01R.js";import{l as f,S as h,B as j}from"./PageWrapper-FKZhqcit.js";import{g as b}from"./snapshot-AWmIpBbQ.js";import{C as T}from"./ContentWrapper-OTqJJiay.js";import{d as w}from"./get-xB22vYAQ.js";import{I}from"./date-WJIA4S6h.js";import{d as v}from"./dayjs.min-Kd2Zu8Td.js";import{D as C,P as N}from"./Table-IcWwFaFI.js";import{T as x}from"./index-oPSmCZfe.js";import"./key-name-frYyCvOB.js";import"./index-Tlz4NJaH.js";import"./_isIterateeCall-igopalK8.js";import"./isSymbol-dVO9QnlM.js";import"./toNumber-_-vq0GBE.js";import"./_baseClone-VYtN7Lua.js";import"./debounce-qpYkvMsV.js";import"./Overflow-JB_g7tJf.js";import"./index-RkOQ1cC1.js";import"./index--4YTblit.js";import"./index-im4EAsxI.js";import"./PlusOutlined-m0myxD_0.js";import"./index--wi1o1rB.js";import"./index-aJjUc7OM.js";import"./index-A6h9dTqZ.js";import"./ReloadOutlined-Te8GBRes.js";async function S(t){var l;const{current:n,pageSize:e,title:s,tags:r}=t,p=(await f.keys()).filter(c=>c.startsWith("paper")),i=[];for(const c of p){const a=await f.getItem(c);s&&(a==null?void 0:a.title.includes(s))!==!0&&((l=a==null?void 0:a.translatedTitle)==null?void 0:l.includes(s))!==!0||r&&r.length>0&&!(a!=null&&a.tags.some(g=>r.includes(g.name)))||a&&i.push(a)}const m=i.sort((c,a)=>(a.mtime||a.ctime)-(c.mtime||c.ctime));if(n&&e){const c=(n-1)*e,a=c+e;return{total:m.length,data:m.slice(c,a)}}return{total:m.length,data:m}}function O(){const[t,n]=u.useState([]),e=()=>f.keys().then(s=>{if(s){n(s);return}n([])});return u.useEffect(()=>{e()},[]),{keys:t,setKeys:n,refresh:e}}function P(){const{keys:t}=O(),[n,e]=u.useState([]),[s,r]=u.useState(!1),d=async()=>{if(!t)return;r(!0);const i=await b();e(i),r(!1)},p=n.map(i=>({label:i,value:i}));return u.useEffect(()=>{d()},[t]),{tagNames:n,tagOptions:p,refresh:d,isLoading:s}}const{useApp:R}=k;function L({paper:t,onChange:n}){const{modal:e,message:s}=R(),r=y();return o.jsx(C.Button,{size:"small",menu:{items:[{label:"备份数据",key:"backup",onClick:async()=>{const d=await w(t.key),p=JSON.stringify(d,null,2),i=new Blob([p],{type:"application/json"}),m=URL.createObjectURL(i),l=document.createElement("a");l.href=m,l.download=`${t.key}-${v().format(I)}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(m)}},{label:"删除",key:"delete",onClick:async()=>{await e.confirm({content:"确认要删除吗？"})&&f.removeItem(t.key).then(()=>{s.success("操作成功"),n()})},danger:!0}]},onClick:()=>r("/reader/"+t.id),children:"详细"})}function B({paper:t}){var n;return o.jsxs(h,{direction:"vertical",size:0,children:[o.jsx("span",{className:"font-semibold",children:t.title}),t.translatedTitle&&o.jsx("span",{className:"text-xs text-gray-600",children:t.translatedTitle}),o.jsxs(h,{size:4,children:[t.arxiv&&o.jsxs(o.Fragment,{children:[o.jsx(x,{color:"cyan",className:"text-xs text-[10px] px-1 m-0 hover:cursor-pointer",onClick:()=>{var e;return window.open((e=t.arxiv)==null?void 0:e.abstract)},children:"Abstract"}),o.jsx(x,{color:"red",className:"text-xs text-[10px] px-1 m-0 hover:cursor-pointer",onClick:()=>{var e;return window.open((e=t.arxiv)==null?void 0:e.pdf)},children:"PDF"})]}),t.github&&o.jsx(x,{color:"gold",className:"text-xs text-[10px] px-1 m-0 hover:cursor-pointer",onClick:()=>{var e;return window.open((e=t.github)==null?void 0:e.url)},children:"Code"}),t.website&&o.jsx(x,{color:"pink",className:"text-xs text-[10px] px-1 m-0 hover:cursor-pointer",onClick:()=>{var e;return window.open((e=t.website)==null?void 0:e.url)},children:"Website"}),((n=t.tags)==null?void 0:n.length)>0&&o.jsx(o.Fragment,{children:t.tags.map((e,s)=>o.jsx(x,{color:e.color,className:"text-xs text-[10px] px-1 m-0",children:e.name},`tag-${e.name}-${s}`))})]})]})}function re(){const t=u.useRef(),{tagOptions:n}=P();return o.jsx(j,{mode:"custom",children:o.jsx(T,{className:"px-5 mt-10",children:o.jsx(N,{actionRef:t,rowKey:"id",options:{density:!1},search:{span:12,className:"m-0 py-0"},request:S,columns:[{title:"ID",key:"id",dataIndex:"id",hideInTable:!0,hideInSearch:!0},{title:"论文",key:"title",dataIndex:"title",renderText:(e,s)=>o.jsx(B,{paper:s})},{title:"标签",key:"tags",dataIndex:"tags",valueType:"select",fieldProps:{mode:"tags",options:n},hideInTable:!0},{title:"最后修改",width:120,key:"modified",renderText:(e,s)=>s.mtime||s.ctime,valueType:"date",hideInSearch:!0},{title:"操作",dataIndex:"cacheKey",key:"operation",hideInSearch:!0,renderText:(e,s)=>o.jsx(L,{paper:s,onChange:()=>{var r;return(r=t.current)==null?void 0:r.reload()}})}]})})})}export{re as default};
