import{R as B,q as $,j as e,v as A,r as c,B as d,T as M,b as W,u as v}from"./index-MtvP_01R.js";import{t as D,P as L}from"./alapi-cn-LNpxjb33.js";import{c as _}from"./get-xB22vYAQ.js";import{S as j,B as E,F as T,l as k}from"./PageWrapper-FKZhqcit.js";import{L as z}from"./logger-bn6oalJg.js";import{a as g,b as C}from"./index-2uBhmTm4.js";import{C as S}from"./ContentWrapper-OTqJJiay.js";import{c as N}from"./key-name-frYyCvOB.js";import{I as h}from"./isSymbol-dVO9QnlM.js";import{T as P}from"./index-oPSmCZfe.js";import{P as U}from"./PlusOutlined-m0myxD_0.js";import{r as V}from"./snapshot-AWmIpBbQ.js";import{S as O}from"./index--4YTblit.js";import{a as q,b as G,d as b,e as H}from"./index-Tlz4NJaH.js";import"./index-aJjUc7OM.js";import{T as K}from"./TranslationOutlined-v3zYHuJb.js";import{P as X}from"./_baseClone-VYtN7Lua.js";import"./axios-G2rPRu76.js";import"./_isIterateeCall-igopalK8.js";import"./toNumber-_-vq0GBE.js";import"./debounce-qpYkvMsV.js";import"./Overflow-JB_g7tJf.js";import"./index-RkOQ1cC1.js";import"./dayjs.min-Kd2Zu8Td.js";import"./index-im4EAsxI.js";var J=["fieldProps","proFieldProps"],Q=function(t,o){var i=t.fieldProps,r=t.proFieldProps,a=$(t,J);return e.jsx(q,A({valueType:"rate",fieldProps:i,ref:o,proFieldProps:r,filedConfig:{ignoreWidth:!0}},a))};const Y=B.forwardRef(Q),F=({children:s})=>e.jsx("div",{className:"w-[50px] text-xs text-right text-gray-500",children:s});function Z({value:s,onChange:t}){const[o,i]=c.useState(!1),[r,a]=c.useState(""),[n,m]=c.useState("");return g(()=>{s&&(a(s==null?void 0:s.abstract),m(s==null?void 0:s.pdf))},[s]),o?e.jsxs(j,{direction:"vertical",className:"w-full",children:[e.jsx(h,{value:r,onChange:u=>a(u.currentTarget.value),size:"small",addonBefore:e.jsx(F,{children:"Abstract"}),placeholder:"请输入"}),e.jsx(h,{value:n,onChange:u=>m(u.currentTarget.value),size:"small",addonBefore:e.jsx(F,{children:"PDF"}),placeholder:"请输入"}),e.jsx(d,{size:"small",onClick:()=>{t==null||t({pdf:n,abstract:r}),i(!1)},children:"确定"})]}):e.jsxs(j,{children:[r&&e.jsx(d,{size:"small",onClick:()=>window.open(r),children:"Abstract"}),n&&e.jsx(d,{size:"small",onClick:()=>window.open(n),children:"PDF"}),e.jsx(d,{size:"small",onClick:()=>i(!0),children:"设置"})]})}const ee=({children:s})=>e.jsx("div",{className:"text-xs text-gray-500",children:s});function se({value:s,onChange:t}){const[o,i]=c.useState(!1),[r,a]=c.useState("");return g(()=>{s&&a(s==null?void 0:s.url)},[s]),o?e.jsxs(j,{direction:"vertical",className:"w-full",children:[e.jsx(h,{value:r,onChange:n=>a(n.currentTarget.value),size:"small",addonBefore:e.jsx(ee,{children:"URL"}),placeholder:"请输入"}),e.jsx(d,{size:"small",onClick:()=>{t==null||t({url:r}),i(!1)},children:"确定"})]}):e.jsxs(j,{children:[r&&e.jsx(d,{type:"link",size:"small",onClick:()=>window.open(r),children:r}),e.jsx(d,{size:"small",onClick:()=>i(!0),children:"设置"})]})}const te=({children:s})=>e.jsx("div",{className:"text-xs text-gray-500",children:s});function re({value:s,onChange:t}){const[o,i]=c.useState(!1),[r,a]=c.useState("");return g(()=>{s&&a(s==null?void 0:s.url)},[s]),o?e.jsxs(j,{direction:"vertical",className:"w-full",children:[e.jsx(h,{value:r,onChange:n=>a(n.currentTarget.value),size:"small",addonBefore:e.jsx(te,{children:"URL"}),placeholder:"请输入"}),e.jsx(d,{size:"small",onClick:()=>{t==null||t({url:r}),i(!1)},children:"确定"})]}):e.jsxs(j,{children:[r&&e.jsx(d,{type:"link",size:"small",onClick:()=>window.open(r),children:r}),e.jsx(d,{size:"small",onClick:()=>i(!0),children:"设置"})]})}const le=({children:s})=>e.jsx("div",{className:"text-xs text-gray-500",children:s});function ie({value:s,onChange:t}){const[o,i]=c.useState(!1),[r,a]=c.useState("");return g(()=>{s&&a(s==null?void 0:s.url)},[s]),o?e.jsxs(j,{direction:"vertical",className:"w-full",children:[e.jsx(h,{value:r,onChange:n=>a(n.currentTarget.value),size:"small",addonBefore:e.jsx(le,{children:"URL"}),placeholder:"请输入"}),e.jsx(d,{size:"small",onClick:()=>{t==null||t({url:r}),i(!1)},children:"确定"})]}):e.jsxs(j,{children:[r&&e.jsx(d,{type:"link",size:"small",onClick:()=>window.open(r),children:r}),e.jsx(d,{size:"small",onClick:()=>i(!0),children:"设置"})]})}const{Search:ae}=h,ne=!1;function oe(){const s=new z(oe.name),t=c.useRef(),[o,i]=c.useState(""),{message:r}=M.useApp(),{paperId:a}=W(),[n,m]=c.useState(),u=v(),p=async()=>{if(!a)return null;const l=await _(N("paper",a));s.debug("paper",l),l&&m(l)};return c.useEffect(()=>{p()},[]),n===void 0?e.jsx(E,{mode:"center",children:e.jsx(S,{className:"px-10",children:e.jsx(O,{spinning:!0})})}):e.jsx(E,{mode:"custom",children:e.jsx(S,{className:"px-10",children:n&&e.jsxs(G,{formRef:t,className:"mt-10 max-w-[600px]",layout:"horizontal",grid:!0,request:async()=>n,labelCol:{span:6},colProps:{span:24},onFinish:async l=>{if(n)return s.debug("onFinish -> values",l),await C(n.key,l),V(),r.success("操作成功"),u(`/reader/${a}`),!0},submitter:{searchConfig:{submitText:"保存更改",resetText:"取消"},onReset:()=>u(`/reader/${a}`),render:(l,x)=>e.jsx(T,{justify:"center",gap:10,align:"center",className:"flex-row-reverse",children:x})},children:[e.jsx(b,{label:"文章名称",name:"title",className:"w-full",children:e.jsx(ae,{onChange:l=>{i(l.currentTarget.value)},enterButton:e.jsx(d,{type:"text",icon:e.jsx(K,{}),onClick:async()=>{var w,y;if(!o)return;const l=N("fanyi",o),x=await k.getItem(l);if(x){s.debug("cachedResult",x),(w=t.current)==null||w.setFieldValue("translatedTitle",x);return}const f=await D(o);s.debug("result",f),f.code!==200&&r.error(f.msg),(y=t.current)==null||y.setFieldValue("translatedTitle",f.data.dst),k.setItem(l,f.data.dst)}})})}),e.jsx(H,{name:["translatedTitle"],children:({translatedTitle:l})=>{if(l)return e.jsx(L,{label:"中文名称",name:"translatedTitle",className:"focus:border-2"})}}),ne&&e.jsx(Y,{label:"评分",name:"score",fieldProps:{allowHalf:!0,className:"text-gray-900"}}),e.jsx(b,{name:"arxiv",label:"arXiv",className:"w-full",children:e.jsx(Z,{})}),e.jsx(b,{name:"paperWithCode",label:"PaperWithCode",className:"w-full",children:e.jsx(re,{})}),e.jsx(b,{name:"github",label:"Github",className:"w-full",children:e.jsx(se,{})}),e.jsx(b,{name:"website",label:"Website",className:"w-full",children:e.jsx(ie,{})}),e.jsx(b,{label:"标签",name:"tags",className:"w-full",children:e.jsx(R,{})})]})})})}const ce=[void 0,"magenta","red","volcano","orange","gold","lime","green","cyan","blue","geekblue","purple"];function de({value:s,onChange:t}){const[o,i]=c.useState(!1);return e.jsx(X,{open:o,onOpenChange:r=>i(r),content:e.jsx(T,{wrap:"wrap",className:"w-[300px] bg-white",children:ce.map(r=>e.jsx(P,{color:r,className:"text-[10px] leading-3 px-1 my-1 hover:cursor-pointer",onClick:()=>{t==null||t(r),i(!1)},children:r||"default"},r||"default"))}),title:"选择颜色",trigger:"click",children:e.jsx(P,{color:s,bordered:!1,className:"hover:cursor-pointer p-0 m-0 leading-3",children:"■"})})}function I({onSubmit:s,value:t,onCancel:o}){const i=c.useRef(null),[r,a]=c.useState((t==null?void 0:t.name)||""),[n,m]=c.useState(t==null?void 0:t.color);c.useEffect(()=>{var l;(l=i.current)==null||l.focus()},[]);const u=l=>{a(l.target.value)},p=async()=>{r&&(s==null||s({name:r,color:n})),a("")};return e.jsx(h,{ref:i,type:"text",size:"small",style:{width:78,marginRight:8,verticalAlign:"top"},value:r,onChange:u,onPressEnter:p,onKeyDown:l=>{l.key==="Escape"&&(o==null||o())},suffix:e.jsx(de,{value:n,onChange:l=>{var x;m(l),(x=i.current)==null||x.focus()}})})}const R=({value:s,onChange:t})=>{const o=new z(R.name),i=s||[],[r,a]=c.useState(!1),[n,m]=c.useState(-1);o.debug("value",s);const u=p=>{const l=[...i];l.splice(p,1),t==null||t(l)};return e.jsxs(e.Fragment,{children:[i.map((p,l)=>n===l?e.jsx(I,{onCancel:()=>{m(-1)},value:i[n],onSubmit:f=>{if(f.name){const w=[...i];w[n]=f,m(-1),t==null||t(w)}else m(-1)}},`tagEditor_${p.name}_${l}`):e.jsx(P,{style:{userSelect:"none"},color:p.color,onClose:()=>u(l),closable:!0,bordered:!0,children:e.jsx("span",{onDoubleClick:f=>{m(l),f.preventDefault()},children:p.name})},`tag_${p.name}_${l}`)),r&&e.jsx(I,{onCancel:()=>a(!1),onSubmit:p=>{if(p.name){const l=[...i,p];t==null||t(l)}a(!1)}}),!r&&e.jsxs(P,{style:{background:"#fff",borderStyle:"dashed"},onClick:()=>a(!0),children:[e.jsx(U,{})," 添加"]})]})};export{oe as default};
