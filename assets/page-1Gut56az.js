import{R as B,a2 as A,j as e,h as D,r as c,B as m,aD as $,b as v,u as V}from"./index-nJ5_Qu1f.js";import{t as _,I as C,X as b,Y as L,D as M,V as W}from"./alapi-cn-Nb8citiB.js";import{b as O}from"./get-tY70BRma.js";import{l as E}from"./localforage-m1Io_pXx.js";import{L as T}from"./logger-bn6oalJg.js";import{a as w,b as U}from"./index-tRa0UiMS.js";import{F as R,B as S}from"./PageWrapper-8_FQrqxr.js";import{C as k}from"./ContentWrapper-Tsk5fy7j.js";import{c as N}from"./key-name-frYyCvOB.js";import{S as j}from"./index-caO_-RUu.js";import{I as h}from"./isSymbol-zxzHQtaF.js";import{a as G}from"./_baseClone-_ueZR0dj.js";import{T as P}from"./index-8PNaXY9C.js";import{P as X}from"./PlusOutlined-Ct-nDfX0.js";import{r as q}from"./snapshot-bw4DbNXS.js";import{S as H}from"./index-a1uKF60-.js";import"./index-YzDeOkHX.js";import{T as K}from"./TranslationOutlined-KiJt4sMo.js";import"./_isIterateeCall-orR7kcV2.js";import"./RightOutlined--2jBD1Y3.js";import"./toNumber-6bwaZxZm.js";import"./debounce-JYfLaqhh.js";import"./Overflow-jrpfKu9v.js";import"./PurePanel-aFiaa7Kc.js";import"./index-5mSCtMnv.js";import"./move-qI-nUOt9.js";import"./dayjs.min-M7lkFoxI.js";import"./index-lMci77ll.js";import"./axios-G2rPRu76.js";var Y=["fieldProps","proFieldProps"],J=function(t,n){var i=t.fieldProps,r=t.proFieldProps,l=A(t,Y);return e.jsx(_,D({valueType:"rate",fieldProps:i,ref:n,proFieldProps:r,filedConfig:{ignoreWidth:!0}},l))};const Q=B.forwardRef(J),F=({children:s})=>e.jsx("div",{className:"w-[50px] text-xs text-right text-gray-500",children:s});function Z({value:s,onChange:t}){const[n,i]=c.useState(!1),[r,l]=c.useState(""),[o,p]=c.useState("");return w(()=>{s&&(l(s==null?void 0:s.abstract),p(s==null?void 0:s.pdf))},[s]),n?e.jsxs(j,{direction:"vertical",className:"w-full",children:[e.jsx(h,{value:r,onChange:u=>l(u.currentTarget.value),size:"small",addonBefore:e.jsx(F,{children:"Abstract"}),placeholder:"请输入"}),e.jsx(h,{value:o,onChange:u=>p(u.currentTarget.value),size:"small",addonBefore:e.jsx(F,{children:"PDF"}),placeholder:"请输入"}),e.jsx(m,{size:"small",onClick:()=>{t==null||t({pdf:o,abstract:r}),i(!1)},children:"确定"})]}):e.jsxs(j,{children:[r&&e.jsx(m,{size:"small",onClick:()=>window.open(r),children:"Abstract"}),o&&e.jsx(m,{size:"small",onClick:()=>window.open(o),children:"PDF"}),e.jsx(m,{size:"small",onClick:()=>i(!0),children:"设置"})]})}const ee=({children:s})=>e.jsx("div",{className:"text-xs text-gray-500",children:s});function se({value:s,onChange:t}){const[n,i]=c.useState(!1),[r,l]=c.useState("");return w(()=>{s&&l(s==null?void 0:s.url)},[s]),n?e.jsxs(j,{direction:"vertical",className:"w-full",children:[e.jsx(h,{value:r,onChange:o=>l(o.currentTarget.value),size:"small",addonBefore:e.jsx(ee,{children:"URL"}),placeholder:"请输入"}),e.jsx(m,{size:"small",onClick:()=>{t==null||t({url:r}),i(!1)},children:"确定"})]}):e.jsxs(j,{children:[r&&e.jsx(m,{type:"link",size:"small",onClick:()=>window.open(r),children:r}),e.jsx(m,{size:"small",onClick:()=>i(!0),children:"设置"})]})}const te=({children:s})=>e.jsx("div",{className:"text-xs text-gray-500",children:s});function re({value:s,onChange:t}){const[n,i]=c.useState(!1),[r,l]=c.useState("");return w(()=>{s&&l(s==null?void 0:s.url)},[s]),n?e.jsxs(j,{direction:"vertical",className:"w-full",children:[e.jsx(h,{value:r,onChange:o=>l(o.currentTarget.value),size:"small",addonBefore:e.jsx(te,{children:"URL"}),placeholder:"请输入"}),e.jsx(m,{size:"small",onClick:()=>{t==null||t({url:r}),i(!1)},children:"确定"})]}):e.jsxs(j,{children:[r&&e.jsx(m,{type:"link",size:"small",onClick:()=>window.open(r),children:r}),e.jsx(m,{size:"small",onClick:()=>i(!0),children:"设置"})]})}const ae=[void 0,"magenta","red","volcano","orange","gold","lime","green","cyan","blue","geekblue","purple"];function ie({value:s,onChange:t}){const[n,i]=c.useState(!1);return e.jsx(G,{open:n,onOpenChange:r=>i(r),content:e.jsx(R,{wrap:"wrap",className:"w-[300px] bg-white",children:ae.map(r=>e.jsx(P,{color:r,className:"text-[10px] leading-3 px-1 my-1 hover:cursor-pointer",onClick:()=>{t==null||t(r),i(!1)},children:r||"default"},r||"default"))}),title:"选择颜色",trigger:"click",children:e.jsx(P,{color:s,bordered:!1,className:"hover:cursor-pointer p-0 m-0 leading-3",children:"■"})})}function I({onSubmit:s,value:t,onCancel:n}){const i=c.useRef(null),[r,l]=c.useState((t==null?void 0:t.name)||""),[o,p]=c.useState(t==null?void 0:t.color);c.useEffect(()=>{var a;(a=i.current)==null||a.focus()},[]);const u=a=>{l(a.target.value)},d=async()=>{r&&(s==null||s({name:r,color:o})),l("")};return e.jsx(h,{ref:i,type:"text",size:"small",style:{width:78,marginRight:8,verticalAlign:"top"},value:r,onChange:u,onPressEnter:d,onKeyDown:a=>{a.key==="Escape"&&(n==null||n())},suffix:e.jsx(ie,{value:o,onChange:a=>{var x;p(a),(x=i.current)==null||x.focus()}})})}const z=({value:s,onChange:t})=>{const n=new T(z.name),i=s||[],[r,l]=c.useState(!1),[o,p]=c.useState(-1);n.debug("value",s);const u=d=>{const a=[...i];a.splice(d,1),t==null||t(a)};return e.jsxs(e.Fragment,{children:[i.map((d,a)=>o===a?e.jsx(I,{onCancel:()=>{p(-1)},value:i[o],onSubmit:f=>{if(f.name){const g=[...i];g[o]=f,p(-1),t==null||t(g)}else p(-1)}},`tagEditor_${d.name}_${a}`):e.jsx(P,{style:{userSelect:"none"},color:d.color,onClose:()=>u(a),closable:!0,bordered:!0,children:e.jsx("span",{onDoubleClick:f=>{p(a),f.preventDefault()},children:d.name})},`tag_${d.name}_${a}`)),r&&e.jsx(I,{onCancel:()=>l(!1),onSubmit:d=>{if(d.name){const a=[...i,d];t==null||t(a)}l(!1)}}),!r&&e.jsxs(P,{style:{background:"#fff",borderStyle:"dashed"},onClick:()=>l(!0),children:[e.jsx(X,{})," 添加"]})]})},{Search:le}=h,oe=!1;function ne(){const s=new T(ne.name),t=c.useRef(),[n,i]=c.useState(""),{message:r}=$.useApp(),{paperId:l}=v(),[o,p]=c.useState(),u=V(),d=async()=>{if(!l)return null;const a=await O(N("paper",l));s.debug("paper",a),a&&p(a)};return c.useEffect(()=>{d()},[]),o===void 0?e.jsx(S,{mode:"center",children:e.jsx(k,{className:"px-10",children:e.jsx(H,{spinning:!0})})}):e.jsx(S,{mode:"custom",children:e.jsx(k,{className:"px-10",children:o&&e.jsxs(C,{formRef:t,className:"mt-10 max-w-[600px]",layout:"horizontal",grid:!0,request:async()=>o,labelCol:{span:6},colProps:{span:24},onFinish:async a=>{if(o)return s.debug("onFinish -> values",a),await U(o.key,a),q(),r.success("操作成功"),u(`/reader/${l}`),!0},submitter:{searchConfig:{submitText:"保存更改",resetText:"取消"},onReset:()=>u(`/reader/${l}`),render:(a,x)=>e.jsx(R,{justify:"center",gap:10,align:"center",className:"flex-row-reverse",children:x})},children:[e.jsx(b,{label:"文章名称",name:"title",className:"w-full",children:e.jsx(le,{onChange:a=>{i(a.currentTarget.value)},enterButton:e.jsx(m,{type:"text",icon:e.jsx(K,{}),onClick:async()=>{var g,y;if(!n)return;const a=N("fanyi",n),x=await E.getItem(a);if(x){s.debug("cachedResult",x),(g=t.current)==null||g.setFieldValue("translatedTitle",x);return}const f=await L(n);s.debug("result",f),f.code!==200&&r.error(f.msg),(y=t.current)==null||y.setFieldValue("translatedTitle",f.data.dst),E.setItem(a,f.data.dst)}})})}),e.jsx(M,{name:["translatedTitle"],children:({translatedTitle:a})=>{if(a)return e.jsx(W,{label:"中文名称",name:"translatedTitle",className:"focus:border-2"})}}),oe&&e.jsx(Q,{label:"评分",name:"score",fieldProps:{allowHalf:!0,className:"text-gray-900"}}),e.jsx(b,{name:"arxiv",label:"arXiv",className:"w-full",children:e.jsx(Z,{})}),e.jsx(b,{name:"paperWithCode",label:"PaperWithCode",className:"w-full",children:e.jsx(re,{})}),e.jsx(b,{name:"github",label:"Github",className:"w-full",children:e.jsx(se,{})}),e.jsx(b,{label:"标签",name:"tags",className:"w-full",children:e.jsx(z,{})})]})})})}export{ne as default};
