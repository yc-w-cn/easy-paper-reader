import{R as B,q as v,j as e,v as A,r as c,B as m,T as $,b as D,u as _}from"./index-l461O1zk.js";import{t as C,P as L}from"./alapi-cn-PMRslL2v.js";import{c as M}from"./get-VWd4L7mn.js";import{S as j,F as I,B as E,l as S}from"./PageWrapper-sLkUscXw.js";import{L as R}from"./logger-bn6oalJg.js";import{a as w,b as V}from"./index-t-m9tvMm.js";import{C as k}from"./ContentWrapper-JLFWJM2O.js";import{c as N}from"./key-name-frYyCvOB.js";import{I as h}from"./isSymbol-ylSl9bjA.js";import{P as W}from"./_baseClone-M4oZtcv9.js";import{T as b}from"./index-yYiLTOPI.js";import{P as O}from"./PlusOutlined-GqqakMkF.js";import{r as U}from"./snapshot-2NbKY0h5.js";import{S as q}from"./index-ALfgnCkM.js";import{a as G,b as H,d as P,e as K}from"./index-y2puK_AQ.js";import"./index-wdq1Sy8x.js";import{T as X}from"./TranslationOutlined-ns2C0YBk.js";import"./axios-G2rPRu76.js";import"./_isIterateeCall-YsVKrjLR.js";import"./toNumber-DTwpbeKl.js";import"./debounce-zHi0SocO.js";import"./Overflow-etUI6nZF.js";import"./index-qjutKuMu.js";import"./dayjs.min-3Z0krTT9.js";import"./index-cAe5g6SG.js";var J=["fieldProps","proFieldProps"],Q=function(t,n){var l=t.fieldProps,r=t.proFieldProps,i=v(t,J);return e.jsx(G,A({valueType:"rate",fieldProps:l,ref:n,proFieldProps:r,filedConfig:{ignoreWidth:!0}},i))};const Y=B.forwardRef(Q),F=({children:s})=>e.jsx("div",{className:"w-[50px] text-xs text-right text-gray-500",children:s});function Z({value:s,onChange:t}){const[n,l]=c.useState(!1),[r,i]=c.useState(""),[o,p]=c.useState("");return w(()=>{s&&(i(s==null?void 0:s.abstract),p(s==null?void 0:s.pdf))},[s]),n?e.jsxs(j,{direction:"vertical",className:"w-full",children:[e.jsx(h,{value:r,onChange:u=>i(u.currentTarget.value),size:"small",addonBefore:e.jsx(F,{children:"Abstract"}),placeholder:"请输入"}),e.jsx(h,{value:o,onChange:u=>p(u.currentTarget.value),size:"small",addonBefore:e.jsx(F,{children:"PDF"}),placeholder:"请输入"}),e.jsx(m,{size:"small",onClick:()=>{t==null||t({pdf:o,abstract:r}),l(!1)},children:"确定"})]}):e.jsxs(j,{children:[r&&e.jsx(m,{size:"small",onClick:()=>window.open(r),children:"Abstract"}),o&&e.jsx(m,{size:"small",onClick:()=>window.open(o),children:"PDF"}),e.jsx(m,{size:"small",onClick:()=>l(!0),children:"设置"})]})}const ee=({children:s})=>e.jsx("div",{className:"text-xs text-gray-500",children:s});function se({value:s,onChange:t}){const[n,l]=c.useState(!1),[r,i]=c.useState("");return w(()=>{s&&i(s==null?void 0:s.url)},[s]),n?e.jsxs(j,{direction:"vertical",className:"w-full",children:[e.jsx(h,{value:r,onChange:o=>i(o.currentTarget.value),size:"small",addonBefore:e.jsx(ee,{children:"URL"}),placeholder:"请输入"}),e.jsx(m,{size:"small",onClick:()=>{t==null||t({url:r}),l(!1)},children:"确定"})]}):e.jsxs(j,{children:[r&&e.jsx(m,{type:"link",size:"small",onClick:()=>window.open(r),children:r}),e.jsx(m,{size:"small",onClick:()=>l(!0),children:"设置"})]})}const te=({children:s})=>e.jsx("div",{className:"text-xs text-gray-500",children:s});function re({value:s,onChange:t}){const[n,l]=c.useState(!1),[r,i]=c.useState("");return w(()=>{s&&i(s==null?void 0:s.url)},[s]),n?e.jsxs(j,{direction:"vertical",className:"w-full",children:[e.jsx(h,{value:r,onChange:o=>i(o.currentTarget.value),size:"small",addonBefore:e.jsx(te,{children:"URL"}),placeholder:"请输入"}),e.jsx(m,{size:"small",onClick:()=>{t==null||t({url:r}),l(!1)},children:"确定"})]}):e.jsxs(j,{children:[r&&e.jsx(m,{type:"link",size:"small",onClick:()=>window.open(r),children:r}),e.jsx(m,{size:"small",onClick:()=>l(!0),children:"设置"})]})}const ae=[void 0,"magenta","red","volcano","orange","gold","lime","green","cyan","blue","geekblue","purple"];function le({value:s,onChange:t}){const[n,l]=c.useState(!1);return e.jsx(W,{open:n,onOpenChange:r=>l(r),content:e.jsx(I,{wrap:"wrap",className:"w-[300px] bg-white",children:ae.map(r=>e.jsx(b,{color:r,className:"text-[10px] leading-3 px-1 my-1 hover:cursor-pointer",onClick:()=>{t==null||t(r),l(!1)},children:r||"default"},r||"default"))}),title:"选择颜色",trigger:"click",children:e.jsx(b,{color:s,bordered:!1,className:"hover:cursor-pointer p-0 m-0 leading-3",children:"■"})})}function T({onSubmit:s,value:t,onCancel:n}){const l=c.useRef(null),[r,i]=c.useState((t==null?void 0:t.name)||""),[o,p]=c.useState(t==null?void 0:t.color);c.useEffect(()=>{var a;(a=l.current)==null||a.focus()},[]);const u=a=>{i(a.target.value)},d=async()=>{r&&(s==null||s({name:r,color:o})),i("")};return e.jsx(h,{ref:l,type:"text",size:"small",style:{width:78,marginRight:8,verticalAlign:"top"},value:r,onChange:u,onPressEnter:d,onKeyDown:a=>{a.key==="Escape"&&(n==null||n())},suffix:e.jsx(le,{value:o,onChange:a=>{var x;p(a),(x=l.current)==null||x.focus()}})})}const z=({value:s,onChange:t})=>{const n=new R(z.name),l=s||[],[r,i]=c.useState(!1),[o,p]=c.useState(-1);n.debug("value",s);const u=d=>{const a=[...l];a.splice(d,1),t==null||t(a)};return e.jsxs(e.Fragment,{children:[l.map((d,a)=>o===a?e.jsx(T,{onCancel:()=>{p(-1)},value:l[o],onSubmit:f=>{if(f.name){const g=[...l];g[o]=f,p(-1),t==null||t(g)}else p(-1)}},`tagEditor_${d.name}_${a}`):e.jsx(b,{style:{userSelect:"none"},color:d.color,onClose:()=>u(a),closable:!0,bordered:!0,children:e.jsx("span",{onDoubleClick:f=>{p(a),f.preventDefault()},children:d.name})},`tag_${d.name}_${a}`)),r&&e.jsx(T,{onCancel:()=>i(!1),onSubmit:d=>{if(d.name){const a=[...l,d];t==null||t(a)}i(!1)}}),!r&&e.jsxs(b,{style:{background:"#fff",borderStyle:"dashed"},onClick:()=>i(!0),children:[e.jsx(O,{})," 添加"]})]})},{Search:ie}=h,oe=!1;function ne(){const s=new R(ne.name),t=c.useRef(),[n,l]=c.useState(""),{message:r}=$.useApp(),{paperId:i}=D(),[o,p]=c.useState(),u=_(),d=async()=>{if(!i)return null;const a=await M(N("paper",i));s.debug("paper",a),a&&p(a)};return c.useEffect(()=>{d()},[]),o===void 0?e.jsx(E,{mode:"center",children:e.jsx(k,{className:"px-10",children:e.jsx(q,{spinning:!0})})}):e.jsx(E,{mode:"custom",children:e.jsx(k,{className:"px-10",children:o&&e.jsxs(H,{formRef:t,className:"mt-10 max-w-[600px]",layout:"horizontal",grid:!0,request:async()=>o,labelCol:{span:6},colProps:{span:24},onFinish:async a=>{if(o)return s.debug("onFinish -> values",a),await V(o.key,a),U(),r.success("操作成功"),u(`/reader/${i}`),!0},submitter:{searchConfig:{submitText:"保存更改",resetText:"取消"},onReset:()=>u(`/reader/${i}`),render:(a,x)=>e.jsx(I,{justify:"center",gap:10,align:"center",className:"flex-row-reverse",children:x})},children:[e.jsx(P,{label:"文章名称",name:"title",className:"w-full",children:e.jsx(ie,{onChange:a=>{l(a.currentTarget.value)},enterButton:e.jsx(m,{type:"text",icon:e.jsx(X,{}),onClick:async()=>{var g,y;if(!n)return;const a=N("fanyi",n),x=await S.getItem(a);if(x){s.debug("cachedResult",x),(g=t.current)==null||g.setFieldValue("translatedTitle",x);return}const f=await C(n);s.debug("result",f),f.code!==200&&r.error(f.msg),(y=t.current)==null||y.setFieldValue("translatedTitle",f.data.dst),S.setItem(a,f.data.dst)}})})}),e.jsx(K,{name:["translatedTitle"],children:({translatedTitle:a})=>{if(a)return e.jsx(L,{label:"中文名称",name:"translatedTitle",className:"focus:border-2"})}}),oe&&e.jsx(Y,{label:"评分",name:"score",fieldProps:{allowHalf:!0,className:"text-gray-900"}}),e.jsx(P,{name:"arxiv",label:"arXiv",className:"w-full",children:e.jsx(Z,{})}),e.jsx(P,{name:"paperWithCode",label:"PaperWithCode",className:"w-full",children:e.jsx(re,{})}),e.jsx(P,{name:"github",label:"Github",className:"w-full",children:e.jsx(se,{})}),e.jsx(P,{label:"标签",name:"tags",className:"w-full",children:e.jsx(z,{})})]})})})}export{ne as default};
