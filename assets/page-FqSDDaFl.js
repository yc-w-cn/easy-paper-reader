import{r as u,u as y,j as s,T as k}from"./index-l461O1zk.js";import{l as f,S as h,B as j}from"./PageWrapper-sLkUscXw.js";import{g as b}from"./snapshot-2NbKY0h5.js";import{C as T}from"./ContentWrapper-JLFWJM2O.js";import{d as I}from"./get-VWd4L7mn.js";import{I as v}from"./date-WJIA4S6h.js";import{d as w}from"./dayjs.min-3Z0krTT9.js";import{D as C,P as N}from"./Table-c9Z9g3up.js";import{T as x}from"./index-yYiLTOPI.js";import"./key-name-frYyCvOB.js";import"./index-y2puK_AQ.js";import"./_isIterateeCall-YsVKrjLR.js";import"./isSymbol-ylSl9bjA.js";import"./toNumber-DTwpbeKl.js";import"./_baseClone-M4oZtcv9.js";import"./debounce-zHi0SocO.js";import"./Overflow-etUI6nZF.js";import"./index-qjutKuMu.js";import"./index-ALfgnCkM.js";import"./index-cAe5g6SG.js";import"./PlusOutlined-GqqakMkF.js";import"./index-2dvF7Uke.js";import"./index-wdq1Sy8x.js";import"./index-0Q2Z4tdF.js";import"./ReloadOutlined-XyfkVv_8.js";async function S(e){var c;const{current:a,pageSize:t,title:n,tags:r}=e,p=(await f.keys()).filter(l=>l.startsWith("paper")),i=[];for(const l of p){const o=await f.getItem(l);n&&(o==null?void 0:o.title.includes(n))!==!0&&((c=o==null?void 0:o.translatedTitle)==null?void 0:c.includes(n))!==!0||r&&r.length>0&&!(o!=null&&o.tags.some(g=>r.includes(g.name)))||o&&i.push(o)}const d=i.sort((l,o)=>l.ctime-o.ctime);if(a&&t){const l=(a-1)*t,o=l+t;return{total:d.length,data:d.slice(l,o)}}return{total:d.length,data:d}}function O(){const[e,a]=u.useState([]),t=()=>f.keys().then(n=>{if(n){a(n);return}a([])});return u.useEffect(()=>{t()},[]),{keys:e,setKeys:a,refresh:t}}function P(){const{keys:e}=O(),[a,t]=u.useState([]),[n,r]=u.useState(!1),m=async()=>{if(!e)return;r(!0);const i=await b();t(i),r(!1)},p=a.map(i=>({label:i,value:i}));return u.useEffect(()=>{m()},[e]),{tagNames:a,tagOptions:p,refresh:m,isLoading:n}}const{useApp:R}=k;function L({paper:e,onChange:a}){const{modal:t,message:n}=R(),r=y();return s.jsx(C.Button,{size:"small",menu:{items:[{label:"备份数据",key:"backup",onClick:async()=>{const m=await I(e.key),p=JSON.stringify(m,null,2),i=new Blob([p],{type:"application/json"}),d=URL.createObjectURL(i),c=document.createElement("a");c.href=d,c.download=`${e.key}-${w().format(v)}.json`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(d)}},{label:"删除",key:"delete",onClick:async()=>{await t.confirm({content:"确认要删除吗？"})&&f.removeItem(e.key).then(()=>{n.success("操作成功"),a()})},danger:!0}]},onClick:()=>r("/reader/"+e.id),children:"详细"})}function B({paper:e}){var a;return s.jsxs(h,{direction:"vertical",size:0,children:[s.jsx("span",{className:"font-semibold",children:e.title}),e.translatedTitle&&s.jsx("span",{className:"text-xs text-gray-600",children:e.translatedTitle}),s.jsxs(h,{size:4,children:[e.arxiv&&s.jsxs(s.Fragment,{children:[s.jsx(x,{color:"cyan",className:"text-xs text-[10px] px-1 m-0 hover:cursor-pointer",onClick:()=>{var t;return window.open((t=e.arxiv)==null?void 0:t.abstract)},children:"Abstract"}),s.jsx(x,{color:"red",className:"text-xs text-[10px] px-1 m-0 hover:cursor-pointer",onClick:()=>{var t;return window.open((t=e.arxiv)==null?void 0:t.pdf)},children:"PDF"})]}),e.github&&s.jsx(x,{color:"gold",className:"text-xs text-[10px] px-1 m-0 hover:cursor-pointer",onClick:()=>{var t;return window.open((t=e.github)==null?void 0:t.url)},children:"Code"}),((a=e.tags)==null?void 0:a.length)>0&&s.jsx(s.Fragment,{children:e.tags.map((t,n)=>s.jsx(x,{color:t.color,className:"text-xs text-[10px] px-1 m-0",children:t.name},`tag-${t.name}-${n}`))})]})]})}function re(){const e=u.useRef(),{tagOptions:a}=P();return s.jsx(j,{mode:"custom",children:s.jsx(T,{className:"px-5 mt-10",children:s.jsx(N,{actionRef:e,rowKey:"id",options:{density:!1},search:{span:12},request:S,columns:[{title:"ID",key:"id",dataIndex:"id",hideInTable:!0,hideInSearch:!0},{title:"论文",key:"title",dataIndex:"title",renderText:(t,n)=>s.jsx(B,{paper:n})},{title:"标签",key:"tags",dataIndex:"tags",valueType:"select",fieldProps:{mode:"tags",options:a},hideInTable:!0},{title:"加入时间",key:"ctime",dataIndex:"ctime",valueType:"date",hideInSearch:!0},{title:"操作",dataIndex:"cacheKey",key:"operation",hideInSearch:!0,renderText:(t,n)=>s.jsx(L,{paper:n,onChange:()=>{var r;return(r=e.current)==null?void 0:r.reload()}})}]})})})}export{re as default};
